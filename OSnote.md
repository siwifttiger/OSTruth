---
title：OS 笔记
---

##kernel/mbr.s
>主引导扇区: mbr程序位于硬盘的第一个扇区，BIOS初始化完成，将会把mbr从硬盘加载到内存的0x7c000处。
实模式下，文本方式显示的显存地址范围是 0xb8000 ~ 0xBFFFF(实模式)。连续的两个字节显示一个字符，低字节显示字符信息，高字节设置字符属性
~~~
这里的mbr主要有两个功能
1.清屏，在屏幕上打印1 asm
2.操作硬盘，从硬盘的第二个扇区读入一个扇区的内容，加载到0x90000的位置，同时跳转到该位置。
3.硬盘操作顺序（个人喜好）：
    a.选择通道，往该通道的sector count寄存器中写入待操作的扇区数
    b.往3个LBA寄存器写入扇区起始地址低24位
    c.往device寄存器写入LBA地址的24~27位，并置第6位为1，设置第4位，选择硬盘。
    d.往command寄存器写入操作命令
    e.获取该通道的status寄存器。判断硬盘工作是否完成。
    f.如果以上步骤是读硬盘，进入g，否则完工
    g.将硬盘数据读出
~~~

##kernel/loader.s
>加载器：位于硬盘第二个扇区，将被mbr读入且加载至内存0x900处。主要的功能就是在屏幕显示字符串，没什么特殊的。